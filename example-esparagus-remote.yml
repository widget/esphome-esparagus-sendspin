
# Example esparagus remote_receiver config - this is for a Â£2 roku IR remote I found on
# aliexpress

script:
  # starting a new stream takes 2-3s, flash something to indicate what's
  # going on
  - id: slow_command_light
    then:
      - repeat:
          count: 2
          then:
            - light.turn_on:
                id: ${led_id}
                blue: 100%
                red: 0%
                green: 0%
                brightness: 60%
            - delay: 1s
            - light.turn_off: ${led_id}
            - delay: 1s
  # blip to acknowledge a short command (e.g. vol up)
  - id: fast_command_light
    then:
      - light.turn_on:
          id: ${led_id}
          blue: 100%
          red: 0%
          green: 0%
          brightness: 60%
      - delay: 50ms
      - light.turn_off: ${led_id}

remote_receiver:
  pin: 
    number: ${gpio_pin}
    inverted: true
    mode:
      input: true
  # dump:
  #   - lg
  on_lg:
    - then:
      - if:
          condition:
            - lambda: 'return (x.data == 0x57E3F10E);' # VOLUME UP (held)
          then:
            - media_player.volume_up: 
                id: external_media_player
            - script.execute: fast_command_light

      - if:
          condition:
            - lambda: 'return (x.data == 0x57E309F6);' # VOLUME DOWN (held)
          then:
            - media_player.volume_down: 
                id: external_media_player
            - script.execute: fast_command_light

      - if:
          condition:
            - lambda: 'return (x.data == 0x57E332CD);' # PLAY/PAUSE (initial)
          then:
            - media_player.toggle: # toggles playing state
                id: external_media_player
            - script.execute: fast_command_light

      - if:
          condition:
            - lambda: 'return (x.data == 0x57E37887);' # LEFT
          then:
            # We need to ask homeassistant to send the previous track
            - homeassistant.action:
                action: media_player.media_previous_track
                data:
                  entity_id: ${destination_player}
            - script.execute: fast_command_light

      - if:
          condition:
            - lambda: 'return (x.data == 0x57E3B44B);' # RIGHT
          then:
            # We need to ask homeassistant to send the next track
            - homeassistant.action:
                action: media_player.media_next_track
                data:
                  entity_id: ${destination_player}
            - script.execute: fast_command_light

      - if:
          condition:
            - lambda: 'return (x.data == 0x57E3E817);' # POWER (initial)
          then:
            - media_player.stop: # toggles playing state (clears queue)
                id: external_media_player
            - script.execute: fast_command_light
      - if:
          condition:
            - lambda: 'return (x.data == 0x57E34AB5);' # 'netflix' special 1
          then:
            - homeassistant.event:
                event: esphome.remote_special
                data:
                  button: "1"
                  entity: ${destination_player}
            - script.execute: slow_command_light
      - if:
          condition:
            - lambda: 'return (x.data == 0x57E3609F);' # 'sling' special 2
          then:
            - homeassistant.event:
                event: esphome.remote_special
                data:
                  button: "2"
                  entity: ${destination_player}
            - script.execute: slow_command_light
      - if:
          condition:
            - lambda: 'return (x.data == 0x57E3FE01);' # 'rdi' special 3
          then:
            - homeassistant.event:
                event: esphome.remote_special
                data:
                  button: "3"
                  entity: ${destination_player}
            - script.execute: slow_command_light
      - if:
          condition:
            - lambda: 'return (x.data == 0x57E3D22D);' # 'amazon' special 4
          then:
            - homeassistant.event:
                event: esphome.remote_special
                data:
                  button: "4"
                  entity: ${destination_player}
            - script.execute: slow_command_light
